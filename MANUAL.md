# PackRaw（パクロー）ユーザーマニュアル

freee勤怠打刻デスクトップアプリケーション

---

## 目次

1. [概要](#概要)
2. [インストール方法](#インストール方法)
3. [初回設定](#初回設定)
4. [基本的な使い方](#基本的な使い方)
5. [勤怠記録の編集機能](#勤怠記録の編集機能)
6. [設定項目](#設定項目)
7. [トラブルシューティング](#トラブルシューティング)

---

## 概要

### PackRawとは

PackRaw（パクロー）は、freeeの勤怠打刻をデスクトップから素早く行えるアプリケーションです。

### 解決する課題

- **freee Web打刻時のセッション切れ問題** → デスクトップアプリで常に接続を維持
- **打刻忘れ・修正忘れ問題** → 過去の打刻を簡単に修正可能
- **休憩時間の記録漏れ問題** → 後から休憩時間を追加・編集可能

### 主な機能

- 🏢 **ワンクリック打刻** - 勤務開始/終了、休憩開始/終了をボタン一つで
- ⏱️ **リアルタイム勤務時間表示** - 現在の勤務時間を自動計算して表示
- 📋 **打刻履歴表示** - 本日および過去の打刻履歴を確認
- ✏️ **勤怠記録編集** - 出勤・退勤・休憩時間を後から修正可能
- 📅 **日付選択機能** - 過去の日付の勤怠記録を表示・編集
- 🔐 **セキュアな認証** - OAuth2.0によるfreee APIとの安全な連携
- 💻 **システムトレイ対応** - 最小化時はトレイに格納

---

## インストール方法

### 動作環境

- **macOS**: macOS 10.15 (Catalina) 以降
- **Windows**: Windows 10 以降

### ダウンロード

[ダウンロードページ](https://drive.google.com/drive/folders/1iSum8GMah5t5AZS-wMM0aTwhjhRrjDc2)から各OS用の最新版をダウンロードしてください。

### macOSでのインストール

1. **DMGファイルを開く**
   - ダウンロードした `PackRaw-<version>-arm64.dmg` をダブルクリック

2. **アプリケーションをインストール**
   - PackRawアプリケーションを「Applications」フォルダにドラッグ＆ドロップ

3. **設定ファイルを配置**
   ```bash
   # ダウンロードページから config.precena.json をダウンロード
   # 以下のコマンドで配置
   cp config.precena.json ~/Library/Application\ Support/PackRaw/freee-app-config.json
   ```

   **注意**:
   - アプリケーションを一度起動すると設定ディレクトリが自動作成されます
   - 初回は設定ファイルがないとエラーになるため、先に配置することを推奨
   - プレセナ用の設定ファイル（`config.precena.json`）は[ダウンロードページ](https://drive.google.com/drive/folders/1iSum8GMah5t5AZS-wMM0aTwhjhRrjDc2)のmacOSフォルダにあります

4. **アプリケーションを起動**
   - Applicationsフォルダから PackRaw を起動
   - 初回起動時にセキュリティ警告が表示された場合:
     - 「システム環境設定」→「セキュリティとプライバシー」
     - 「このまま開く」をクリック

### Windowsでのインストール

1. **ZIPファイルを解凍**
   - ダウンロードした `PackRaw-x.x.x-win.zip` を任意のフォルダに解凍

2. **設定ファイルを初期化**
   - 解凍したフォルダ内の `install.bat` をダブルクリックして実行
   - これにより設定ファイルが自動的に配置されます

3. **アプリケーションを起動**
   - `PackRaw-<version>.exe` をダブルクリックして起動

---

## 初回設定

### freee認証の設定

初回起動時にfreeeアカウントとの連携が必要です。

1. **アプリケーションを起動**
   - アプリを開くと「freee認証が必要です」という画面が表示されます

2. **ログインボタンをクリック**
   - 「freeeにログイン」ボタンをクリック

3. **freee認証画面で許可**
   - ブラウザが開き、freeeの認証画面が表示されます
   - 「許可する」ボタンをクリック

4. **自動設定完了**
   - 認証が完了すると、自動的に従業員情報とトークンが保存されます
   - アプリのメイン画面が表示されます

### 認証トークンの有効期限

- **アクセストークン**: 6時間（自動更新されます）
- **リフレッシュトークン**: 90日間
  - 90日を過ぎた場合は再度「freeeにログイン」から認証が必要です

---

## 基本的な使い方

### 画面構成

```
┌─────────────────────────────────┐
│  ユーザー名               [⚙️]  │ ← ヘッダー（設定ボタン）
├─────────────────────────────────┤
│  [◀] 2025年10月20日（月）[▶]  │ ← 日付選択
│     の勤務時間                  │
│        08:30                    │ ← リアルタイム勤務時間
├─────────────────────────────────┤
│      [🏢 勤務開始]  ←今日の場合 │
│      [🏠 勤務終了]   のみ表示   │
│      [☕ 休憩開始]              │
│      [💼 休憩終了]              │
├─────────────────────────────────┤
│  出勤  09:00 [✏️]               │ ← 打刻履歴
│  退勤  18:00 [✏️]               │   （編集可能）
│                                 │
│  休憩履歴              [+]      │
│  12:00 → 13:00 (60分)           │
│           [✏️] [🗑️]            │
└─────────────────────────────────┘
```

### 打刻操作

#### 1. 勤務開始（出勤）

1. 出社したら「🏢 勤務開始」ボタンをクリック
2. 打刻が完了すると、履歴に時刻が記録されます
3. 勤務時間のカウントが自動的に開始されます

#### 2. 休憩開始

1. 休憩に入る前に「☕ 休憩開始」ボタンをクリック
2. 休憩中は勤務時間のカウントが停止します

#### 3. 休憩終了

1. 休憩から戻ったら「💼 休憩終了」ボタンをクリック
2. 勤務時間のカウントが再開されます
3. 休憩履歴に休憩時間が記録されます

#### 4. 勤務終了（退勤）

1. 退社時に「🏠 勤務終了」ボタンをクリック
2. 本日の勤務が終了します
3. 勤務時間が確定します

### 打刻ボタンの動作ルール

- **勤務開始**: 未打刻の状態でのみ有効
- **休憩開始**: 勤務開始後、かつ休憩中でない場合に有効
- **休憩終了**: 休憩開始後のみ有効
- **勤務終了**: 勤務開始後、かつ休憩中でない場合に有効

※ 現在の状態に応じて、押せるボタンのみが有効になります

### 勤務時間の表示

画面上部に表示される勤務時間は、以下のように計算されます：

```
勤務時間 = (現在時刻 - 出勤時刻) - 休憩時間の合計
```

- リアルタイムで自動更新されます
- 休憩時間は自動的に差し引かれます
- 退勤打刻後は、確定した勤務時間が表示されます

---

## 勤怠記録の編集機能

打刻忘れや時刻の修正が必要な場合、過去の打刻記録を編集できます。

### 日付の選択

1. **日付ナビゲーション**
   - 画面上部の `[◀]` `[▶]` ボタンで日付を変更
   - `[◀]`: 前日
   - `[▶]`: 翌日（今日より未来には進めません）

2. **表示される情報**
   - 選択した日付の勤怠記録が表示されます
   - 今日の場合は「今日」バッジが表示されます
   - 過去の日付の場合は打刻ボタンは表示されません

### 出勤・退勤時刻の修正

1. **編集ボタンをクリック**
   - 出勤または退勤時刻の横にある ✏️ アイコンをクリック

2. **時刻を入力**
   - モーダルが開き、時刻入力欄が表示されます
   - HH:MM 形式（例: 09:00）で入力

3. **保存**
   - 「保存」ボタンをクリックして確定
   - freeeに反映されます

**⚠️ 注意**:
- **退勤打刻がない場合は編集できません**
- 編集ボタンがグレーアウトされ、マウスオーバー時に「退勤打刻後に修正が可能になります」と表示されます
- これはfreee APIの仕様上の制限です

### 休憩時間の編集

#### 既存の休憩時間を修正

1. **編集ボタンをクリック**
   - 休憩履歴の各エントリの横にある ✏️ アイコンをクリック

2. **休憩開始・終了時刻を入力**
   - 休憩開始時刻と終了時刻をそれぞれ入力
   - HH:MM 形式（例: 12:00, 13:00）

3. **保存**
   - 「保存」ボタンをクリックして確定

#### 休憩時間を追加

1. **追加ボタンをクリック**
   - 「休憩履歴」セクションの右上にある [+] ボタンをクリック

2. **休憩時間を入力**
   - 休憩開始時刻と終了時刻を入力

3. **保存**
   - 「保存」ボタンをクリックして追加

**使用例**:
- 休憩打刻を忘れた場合
- 複数回の休憩を取った場合

#### 休憩時間を削除

1. **削除ボタンをクリック**
   - 休憩履歴の各エントリの横にある 🗑️ アイコンをクリック

2. **確認**
   - 削除確認ダイアログが表示されます
   - 「OK」をクリックして削除を実行

**⚠️ 注意**:
- 休憩時間の編集・追加・削除も**退勤打刻後のみ可能**です
- 退勤打刻がない場合、編集ボタンはグレーアウトされます

### 編集時の注意事項

1. **退勤打刻は必須**
   - 出勤時刻、休憩時間の編集は、退勤打刻が完了している場合のみ可能
   - freee APIの仕様上の制限です

2. **時刻の整合性**
   - 時刻は論理的な順序で入力してください
   - 例: 休憩開始時刻 < 休憩終了時刻

3. **即座に反映**
   - 編集内容はすぐにfreeeに反映されます
   - 編集後、自動的に最新の勤怠記録が取得されます

---

## 設定項目

画面右上の ⚙️ アイコンから設定画面を開けます。

### PowerMonitor（自動休憩機能）

PCのシステムイベント（画面ロック、スリープ）を検知して、自動的に休憩打刻を行う機能です。

#### 設定方法

1. **設定画面を開く**
   - 画面右上の ⚙️ アイコンをクリック

2. **PowerMonitorを有効化**
   - 「PCイベント監視」のトグルスイッチをONにする

3. **動作確認**
   - 有効化すると、以下のイベントが検知されます:
     - 画面ロック
     - 画面アンロック
     - スリープ
     - スリープ解除

#### 動作内容

現在のバージョンでは、イベントを検知すると以下の処理が実行されます：

- **イベント検知時**
  - 画面をリフレッシュ（ボタン状態と打刻履歴を更新）
  - 最新の勤務記録を取得

**⚠️ 注意**:
- 現在は自動打刻機能は実装されていません（将来追加予定）
- イベント検知による画面更新のみが動作します

#### 効果

- PCをロックした際に、自動的に最新の打刻状態を反映
- スリープから復帰した際に、画面を最新の状態に更新

### ウィンドウ設定

#### 常に最前面表示

- デフォルトで有効になっています
- 他のウィンドウの前面に常に表示されます
- 作業中でも打刻しやすくなります

#### ウィンドウサイズ

- デフォルト: 500 x 500 ピクセル
- リサイズ可能です
- 設定は自動的に保存されます

### システムトレイ（macOS）

- ウィンドウを閉じるとシステムトレイに格納されます
- トレイアイコンをクリックすると、ウィンドウが再表示されます
- トレイアイコンを右クリックすると、メニューが表示されます:
  - **ウィンドウを表示**: アプリを前面に表示
  - **アプリを終了**: アプリを完全に終了

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. 「API service not initialized」エラー

**原因**: 設定ファイルが正しく配置されていない

**解決方法**:
1. 設定ファイルの配置場所を確認
   - **macOS**: `~/Library/Application Support/PackRaw/freee-app-config.json`
   - **Windows**: `%APPDATA%\PackRaw\freee-app-config.json`
2. config.precena.json を正しい場所にコピー
3. アプリを再起動

#### 2. 「リフレッシュトークンの有効期限が切れています」エラー

**原因**: 90日以上経過してリフレッシュトークンが失効

**解決方法**:
1. アプリのメイン画面で「freeeにログイン」ボタンをクリック
2. freee認証画面で再度許可
3. 自動的に新しいトークンが発行されます

#### 3. 打刻が失敗する

**原因**: freee側の設定や、APIの接続に問題がある

**解決方法**:
1. インターネット接続を確認
2. freee Web画面で勤怠設定を確認
3. 事業所ID（companyId）が正しいか確認
4. それでも解決しない場合は、再認証を試す

#### 4. 勤務時間が表示されない（00:00のまま）

**原因**: 打刻直後でwork_records APIにデータが反映されていない

**解決方法**:
- 通常は数秒〜数分で自動的に表示されます
- 画面を更新（日付を前後に動かして戻す）すると最新データが取得されます
- それでも表示されない場合は、アプリを再起動

#### 5. 時刻がずれて表示される

**原因**: PCのタイムゾーン設定が日本時間（JST）になっていない

**解決方法**:
1. PCのタイムゾーン設定を確認
2. 日本時間（UTC+9）に設定
3. アプリを再起動

#### 6. 退勤打刻がない場合に編集できない

**原因**: freee APIの仕様上の制限

**解決方法**:
1. まず退勤打刻を行う
2. 退勤打刻後に出勤時刻や休憩時間を編集可能になります
3. 編集ボタンがグレーアウトしている場合は、マウスオーバーで理由が表示されます

#### 7. Port 3000 is already in use エラー（開発者向け）

**原因**: 開発サーバーがすでに起動している

**解決方法**:
```bash
# ポート3000を使用しているプロセスを停止
lsof -ti:3000 | xargs kill -9

# または、すべての関連プロセスを停止
pkill -9 -f "electron|vite|concurrently"
```

### サポート

問題が解決しない場合は、以下までご連絡ください：

- **Slack**: [#times_kobaken](https://precena.slack.com/archives/CF7PFK3SN)
- **問題報告**: [GitHubのIssue](https://github.com/your-org/freee-webview-app/issues)（開発者向け）

---

## セキュリティとプライバシー

### データの保存場所

- **認証トークン**: ローカルディスク上に暗号化して保存
- **設定情報**: electron-storeにより安全に管理

### セキュリティ機能

- ✅ OAuth2.0による安全な認証
- ✅ アクセストークンは6時間で自動更新
- ✅ リフレッシュトークンは90日間有効
- ✅ 認証情報はローカルに暗号化して保存
- ✅ freee APIとの通信は全てHTTPS

### プライバシー

- インターネット接続はfreee APIとの通信のみ
- 勤怠データは全てfreee上に保存され、アプリには一時的にキャッシュされるのみ
- 第三者にデータが送信されることはありません

---

## バージョン情報

- **現在のバージョン**: v2.0
- **対応freee人事労務API**: v1
- **Electron**: 37.2.0
- **React**: 19.1.0

### 最新バージョンの確認

最新版は[ダウンロードページ](https://drive.google.com/drive/folders/1iSum8GMah5t5AZS-wMM0aTwhjhRrjDc2)で確認できます。

---

## ライセンス

ISC License

---

**©️ 2025 PackRaw - freee勤怠打刻デスクトップアプリケーション**
