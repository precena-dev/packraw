# PackRaw（パクロー）ユーザーマニュアル

freee勤怠打刻デスクトップアプリケーション

---

## 目次

1. [概要](#概要)
2. [インストール方法](#インストール方法)
3. [初回設定](#初回設定)
4. [基本的な使い方](#基本的な使い方)
5. [勤怠記録の編集機能](#勤怠記録の編集機能)
6. [設定項目](#設定項目)
7. [トラブルシューティング](#トラブルシューティング)

---

## 概要

### PackRawとは

PackRaw（パクロー）は、freeeの勤怠打刻をデスクトップから素早く行えるアプリケーションです。

### 解決する課題

- **freee Web打刻時のセッション切れ問題** → デスクトップアプリで常に接続を維持
- **打刻忘れ・修正忘れ問題** → 過去の打刻を簡単に修正可能
- **休憩時間の記録漏れ問題** → 後から休憩時間を追加・編集可能

### 主な機能

- 🏢 **ワンクリック打刻** - 勤務開始/終了、休憩開始/終了をボタン一つで
- ⏱️ **リアルタイム勤務時間表示** - 現在の勤務時間を自動計算して表示
- 📋 **打刻履歴表示** - 本日および過去の打刻履歴を確認
- ✏️ **勤怠記録編集** - 出勤・退勤・休憩時間を後から修正可能
- 📝 **勤怠記録の一括作成** - 打刻忘れの日の勤怠記録を後から作成
- 🗑️ **勤怠記録の削除** - 誤って登録した勤怠記録を未入力状態に戻す
- 📅 **日付選択機能** - 過去の日付の勤怠記録を表示・編集
- 📆 **カレンダーUI** - カレンダーから直接日付を選択、勤怠記録のある日をハイライト表示
- ⏰ **休憩打刻予約** - 自動休憩打刻機能（時刻指定・ランダム誤差）
- 🤖 **自動出勤・退勤** - アプリ起動時の自動出勤、PCシャットダウン時の自動退勤
- ⚡ **PowerMonitor連携** - システムイベント（画面ロック・スリープ）の検知と自動打刻
- 🕐 **指定時刻以降の自動退勤** - 設定時刻以降のスリープ・画面ロック時に自動退勤
- ❗ **エラーモーダル** - エラー発生時に詳細情報を表示
- 🔐 **セキュアな認証** - OAuth2.0によるfreee APIとの安全な連携
- 💻 **システムトレイ対応** - 最小化時はトレイに格納

---

## インストール方法

### 動作環境

- **macOS**: macOS 10.15 (Catalina) 以降
- **Windows**: Windows 10 以降

### ダウンロード

#### GitHub Releasesからダウンロード（推奨）

最新版は[GitHubのReleasesページ](https://github.com/precena-dev/packraw/releases)からダウンロードできます。

- **Windows（インストーラー版・推奨）**: `PackRaw-Setup-x.x.x.exe`
  - 自動更新対応 ✅
  - インストール先: `C:\Users\{ユーザー名}\AppData\Local\Programs\PackRaw`
- **macOS**: `PackRaw-x.x.x-arm64.dmg` または `PackRaw-x.x.x.dmg`

#### 従来のダウンロード方法

[ダウンロードページ](https://drive.google.com/drive/folders/1iSum8GMah5t5AZS-wMM0aTwhjhRrjDc2)から各OS用の最新版をダウンロードしてください。

### macOSでのインストール

1. **DMGファイルを開く**
   - ダウンロードした `PackRaw-<version>-arm64.dmg` をダブルクリック

2. **アプリケーションをインストール**
   - PackRawアプリケーションを「Applications」フォルダにドラッグ＆ドロップ

3. **設定ファイルを配置**
   ```bash
   # ダウンロードページから config.precena.json をダウンロード
   # 以下のコマンドで配置
   cp config.precena.json ~/Library/Application\ Support/PackRaw/freee-app-config.json
   ```

   **注意**:
   - アプリケーションを一度起動すると設定ディレクトリが自動作成されます
   - 初回は設定ファイルがないとエラーになるため、先に配置することを推奨
   - プレセナ用の設定ファイル（`config.precena.json`）は[ダウンロードページ](https://drive.google.com/drive/folders/1iSum8GMah5t5AZS-wMM0aTwhjhRrjDc2)のmacOSフォルダにあります

4. **アプリケーションを起動**
   - Applicationsフォルダから PackRaw を起動
   - 初回起動時にセキュリティ警告が表示された場合:
     - 「システム環境設定」→「セキュリティとプライバシー」
     - 「このまま開く」をクリック

### Windowsでのインストール

1. **インストーラーを実行**
   - ダウンロードした `PackRaw-Setup-x.x.x.exe` をダブルクリック

2. **セキュリティ警告について**
   - Windows SmartScreen警告が表示された場合:
     - 「詳細情報」をクリック
     - 「実行」ボタンをクリック
   - これは証明書なしでのビルドのため表示されます（社内利用のため問題ありません）

3. **インストール設定**
   - インストール先を選択（デフォルト: `C:\Users\{ユーザー名}\AppData\Local\Programs\PackRaw`）
   - デスクトップショートカットを作成するか選択
   - スタートメニューに登録するか選択

4. **インストール完了**
   - インストールが完了すると、自動的にPackRawが起動します
   - 初回起動時にfreee認証が必要です

**設定ファイルについて**:
- 設定ファイルは自動的に `C:\Users\{ユーザー名}\AppData\Roaming\PackRaw\freee-app-config.json` に作成されます
- 初回起動時にfreee認証を行うと、自動的に設定が保存されます

---

## 初回設定

### freee認証の設定

初回起動時にfreeeアカウントとの連携が必要です。

1. **アプリケーションを起動**
   - アプリを開くと「freee認証が必要です」という画面が表示されます

2. **ログインボタンをクリック**
   - 「freeeにログイン」ボタンをクリック

3. **freee認証画面で許可**
   - ブラウザが開き、freeeの認証画面が表示されます
   - 「許可する」ボタンをクリック

4. **自動設定完了**
   - 認証が完了すると、自動的に従業員情報とトークンが保存されます
   - アプリのメイン画面が表示されます

### 認証トークンの有効期限

- **アクセストークン**: 6時間（自動更新されます）
- **リフレッシュトークン**: 90日間
  - 90日を過ぎた場合は再度「freeeにログイン」から認証が必要です

---

## 基本的な使い方

### 画面構成（v2.4）

```
┌─────────────────────────────────┐
│  ユーザー名               [⚙️]  │ ← ヘッダー（設定ボタン）
├─────────────────────────────────┤
│  [◀] 2025年10月20日（月）[▶]  │ ← 日付選択（クリックでカレンダー表示）
│       勤務時間 08:30            │ ← リアルタイム勤務時間（36px）
├─────────────────────────────────┤
│      [👤 出勤]   ←今日の場合    │ ← v2.3: アイコン統一
│      [🚪 退勤]    のみ表示      │
│      [⏸️ 休憩開始]              │
│      [▶️ 休憩終了]              │
├─────────────────────────────────┤
│  👤 出勤  09:00 [✏️]            │ ← 打刻履歴（編集可能）
│  🚪 退勤  18:00 [✏️]            │
│                                 │
│  休憩履歴  [⚡][🕐][+]          │ ← PowerMonitor / 予約表示
│  12:00 → 13:00 (60分)           │
│           [✏️] [🗑️]            │
└─────────────────────────────────┘
```

**新機能アイコン説明**:
- ⚡ **稲妻アイコン**: PowerMonitor有効時に表示（システムイベント監視中）
- 🕐 **時計アイコン**: 休憩予約がある場合に表示（ホバーで予約時刻表示）

### 打刻操作

#### 1. 勤務開始（出勤）

1. 出社したら「🏢 勤務開始」ボタンをクリック
2. 打刻が完了すると、履歴に時刻が記録されます
3. 勤務時間のカウントが自動的に開始されます

#### 2. 休憩開始

1. 休憩に入る前に「☕ 休憩開始」ボタンをクリック
2. 休憩中は勤務時間のカウントが停止します

#### 3. 休憩終了

1. 休憩から戻ったら「💼 休憩終了」ボタンをクリック
2. 勤務時間のカウントが再開されます
3. 休憩履歴に休憩時間が記録されます

#### 4. 勤務終了（退勤）

1. 退社時に「🏠 勤務終了」ボタンをクリック
2. 本日の勤務が終了します
3. 勤務時間が確定します

### 打刻ボタンの動作ルール

- **勤務開始**: 未打刻の状態でのみ有効
- **休憩開始**: 勤務開始後、かつ休憩中でない場合に有効
- **休憩終了**: 休憩開始後のみ有効
- **勤務終了**: 勤務開始後、かつ休憩中でない場合に有効

※ 現在の状態に応じて、押せるボタンのみが有効になります

### 勤務時間の表示

画面上部に表示される勤務時間は、以下のように計算されます：

```
勤務時間 = (現在時刻 - 出勤時刻) - 休憩時間の合計
```

- リアルタイムで自動更新されます
- 休憩時間は自動的に差し引かれます
- 退勤打刻後は、確定した勤務時間が表示されます

---

## 勤怠記録の編集機能

打刻忘れや時刻の修正が必要な場合、過去の打刻記録を編集できます。

### 日付の選択

#### 方法1: ナビゲーションボタン

1. **日付ナビゲーション**
   - 画面上部の `[◀]` `[▶]` ボタンで日付を変更
   - `[◀]`: 前日
   - `[▶]`: 翌日（今日より未来には進めません）

#### 方法2: カレンダーUI（v2.4新機能）

1. **カレンダーを開く**
   - 日付部分（例: 2025年10月20日（月））をクリック
   - カレンダーモーダルが表示されます

2. **カレンダーの機能**
   - **月間表示**: 月曜日始まりの7×6グリッドレイアウト
   - **月の移動**: 左右の矢印ボタンで前月・次月に移動
   - **今日に戻る**: 「今日に戻る」ボタンで現在の日付に戻る
   - **日付選択**: カレンダーの日付をクリックして選択
   - **勤怠記録ハイライト**: 勤怠記録がある日に緑の小さなドット（●）が表示されます

3. **視覚的フィードバック**
   - **今日の日付**: 青色テキストで強調
   - **選択中の日付**: 青背景で表示
   - **他の月の日付**: グレーアウト表示
   - **勤怠記録がある日**: 緑のドット（●）表示
   - **ホバー時**: グレー背景でハイライト

4. **未来日の選択について**
   - 今日より未来の日付は選択できません
   - 選択しても反映されません

5. **カレンダーを閉じる**
   - 日付を選択すると自動的に閉じます
   - 「閉じる」ボタンをクリック
   - カレンダー外の領域をクリック

#### 表示される情報

- 選択した日付の勤怠記録が表示されます
- 今日の場合は「今日」バッジが表示されます
- 過去の日付の場合は打刻ボタンは表示されません

### 出勤・退勤時刻の修正

1. **編集ボタンをクリック**
   - 出勤または退勤時刻の横にある ✏️ アイコンをクリック

2. **時刻を入力**
   - モーダルが開き、時刻入力欄が表示されます
   - HH:MM 形式（例: 09:00）で入力

3. **保存**
   - 「保存」ボタンをクリックして確定
   - freeeに反映されます

**⚠️ 注意**:
- **退勤打刻がない場合は編集できません**
- 編集ボタンがグレーアウトされ、マウスオーバー時に「退勤打刻後に修正が可能になります」と表示されます
- これはfreee APIの仕様上の制限です

### 休憩時間の編集

#### 既存の休憩時間を修正

1. **編集ボタンをクリック**
   - 休憩履歴の各エントリの横にある ✏️ アイコンをクリック

2. **休憩開始・終了時刻を入力**
   - 休憩開始時刻と終了時刻をそれぞれ入力
   - HH:MM 形式（例: 12:00, 13:00）

3. **保存**
   - 「保存」ボタンをクリックして確定

#### 休憩時間を追加

1. **追加ボタンをクリック**
   - 「休憩履歴」セクションの右上にある [+] ボタンをクリック

2. **休憩時間を入力**
   - 休憩開始時刻と終了時刻を入力

3. **保存**
   - 「保存」ボタンをクリックして追加

**使用例**:
- 休憩打刻を忘れた場合
- 複数回の休憩を取った場合

#### 休憩時間を削除

1. **削除ボタンをクリック**
   - 休憩履歴の各エントリの横にある 🗑️ アイコンをクリック

2. **確認**
   - 削除確認ダイアログが表示されます
   - 「OK」をクリックして削除を実行

**⚠️ 注意**:
- 休憩時間の編集・追加・削除も**退勤打刻後のみ可能**です
- 退勤打刻がない場合、編集ボタンはグレーアウトされます

### 編集時の注意事項

1. **退勤打刻は必須**
   - 出勤時刻、休憩時間の編集は、退勤打刻が完了している場合のみ可能
   - freee APIの仕様上の制限です

2. **時刻の整合性**
   - 時刻は論理的な順序で入力してください
   - 例: 休憩開始時刻 < 休憩終了時刻

3. **即座に反映**
   - 編集内容はすぐにfreeeに反映されます
   - 編集後、自動的に最新の勤怠記録が取得されます

### 過去日の勤怠記録を一括作成

打刻を忘れた日の勤怠記録を後から一括で登録できます。

#### 使い方

1. **過去の日付を選択**
   - 日付ナビゲーションまたはカレンダーで打刻忘れの日付を選択

2. **「勤怠の登録」ボタンをクリック**
   - 打刻記録がない日付の場合、画面中央に「勤怠の登録」ボタンが表示されます
   - ボタンをクリックして登録モーダルを開きます

3. **勤怠情報を入力**
   - **出勤時刻**: 出勤した時刻（例: 09:00）
   - **退勤時刻**: 退勤した時刻（例: 18:00）
   - **休憩時間**: 休憩の開始時刻と終了時刻
     - デフォルトで1つの休憩時間が入力されています（12:00 - 13:00）
     - 「+」ボタンで追加の休憩時間を追加できます
     - 「ゴミ箱」アイコンで休憩時間を削除できます

4. **入力バリデーション**
   - 時刻は HH:MM 形式で入力してください
   - 退勤時刻は出勤時刻より後である必要があります
   - 休憩時間は勤務時間内である必要があります
   - 休憩終了時刻は休憩開始時刻より後である必要があります

5. **登録**
   - 「登録」ボタンをクリックして保存
   - freeeに勤怠記録が作成されます

**使用例**:
- 打刻を忘れた日の勤怠記録を後から作成
- 複数の休憩時間を含む勤怠記録の作成

### 過去日の勤怠記録を削除

誤って登録した勤怠記録を削除して、未入力状態に戻すことができます。

#### 使い方

1. **削除したい日付を選択**
   - 日付ナビゲーションまたはカレンダーで該当日付を選択

2. **「勤怠を未入力にする」ボタンをクリック**
   - 打刻記録がある日付の場合、画面中央に「勤怠を未入力にする」ボタンが表示されます
   - ボタンをクリックすると確認モーダルが表示されます

3. **削除を確認**
   - 確認モーダルで削除する日付を確認
   - 「削除」ボタンをクリックして実行

4. **削除完了**
   - 勤怠記録が削除され、未入力状態に戻ります
   - 必要に応じて、再度「勤怠の登録」から新しい記録を作成できます

**⚠️ 注意**:
- 削除された勤怠記録は復元できません
- 削除後、必要に応じて正しい勤怠記録を再登録してください

### エラー発生時の対応

操作中にエラーが発生した場合、エラーモーダルが表示されます。

#### エラーモーダルの機能

1. **エラーメッセージの表示**
   - 丸に「!」マークの赤いアイコンが表示されます
   - 主要なエラーメッセージが表示されます:
     ```
     勤怠登録に不整合があるかもしれません。
     2025/10/25に関しての操作は
     freeeのweb画面から実施して下さい。
     ```

2. **詳細情報の確認**
   - 「詳細を表示」をクリックすると、技術的なエラー詳細が表示されます
   - デフォルトでは折りたたまれています
   - エラーの原因を詳しく知りたい場合に展開できます

3. **モーダルを閉じる**
   - 「OK」ボタンをクリックしてモーダルを閉じます
   - エラーメッセージを確認した後、freee Web画面で操作を行ってください

**よくあるエラー**:
- freee API側の制約により操作が失敗した場合
- 勤怠記録に不整合がある場合
- 上記の場合は、freee Web画面から操作を行う必要があります

---

## UI/UX機能詳細

### アイコンとボタンの統一（v2.3）

PackRawでは、直感的な操作のためにアイコンとテキストを統一しています。

#### 打刻ボタンのアイコン

- **👤 出勤ボタン**: 人アイコン + 「出勤」テキスト
  - 履歴表示の出勤時刻と同じアイコンを使用
  - 一貫した視覚的フィードバック

- **🚪 退勤ボタン**: ドアアイコン + 「退勤」テキスト
  - 履歴表示の退勤時刻と同じアイコンを使用
  - 退出を連想させるデザイン

- **⏸️ 休憩開始ボタン**: 一時停止アイコン
  - 作業の一時停止を表現

- **▶️ 休憩終了ボタン**: 再生アイコン
  - 作業の再開を表現

#### 履歴・編集のアイコン

- **✏️ 鉛筆アイコン**: 編集ボタン
  - 出勤・退勤・休憩時間の修正

- **🗑️ ゴミ箱アイコン**: 削除ボタン
  - 休憩時間の削除

- **+ プラスアイコン**: 追加ボタン
  - 休憩時間の追加

#### 状態表示のアイコン

- **⚡ 稲妻アイコン**: PowerMonitor有効時
  - 休憩履歴セクションに表示
  - 青色で表示
  - システムイベント監視中を示す

- **🕐 時計アイコン**: 休憩予約がある場合
  - 休憩履歴セクションの「+」ボタンの左に表示
  - アンバー色（琥珀色）のパルスアニメーション
  - マウスホバーで予約時刻をツールチップ表示
  - 今日の日付の場合のみ表示

### ヘッダーレイアウト（v2.4改善）

勤務時間の視認性を向上させるため、ヘッダーレイアウトを最適化しました。

#### レイアウト変更

**変更前**:
```
2025年10月20日（月）の勤務時間
        08:30
```

**変更後**:
```
2025年10月20日（月）
  勤務時間 08:30
```

#### 改善点

- **中央揃え**: 日付と勤務時間の両行を中央揃えに統一
- **時刻の拡大表示**: 勤務時間を36pxに拡大（従来は28px）
- **横並びレイアウト**: 「勤務時間」ラベルと時刻を横並びに配置
- **ラベルサイズ**: 「勤務時間」を日付と同じ12pxに縮小

これにより、一目で現在の勤務時間を把握できるようになりました。

### カレンダーUIのデザイン（v2.4）

#### ビジュアルデザイン

- **モダンな白背景**: 清潔感のあるホワイトベース
- **丸角デザイン**: 12pxの角丸で柔らかい印象
- **ドロップシャドウ**: 浮き上がり効果で視認性向上
- **レスポンシブ**: 最大幅400px、画面サイズに応じて調整

#### カラーリング

- **今日の日付**: 青色テキスト（#3b82f6）
- **選択中の日付**: 青背景（#3b82f6）
- **他の月の日付**: グレー（#94a3b8）
- **勤怠記録ドット**: 緑色（#4caf50）
- **ホバー時**: グレー背景（#f1f5f9）

#### アニメーション

- **ホバーエフェクト**: マウスを重ねると背景色が変化
- **クリック時**: スムーズな日付選択
- **モーダル表示**: フェードイン/アウト効果

### 視覚的フィードバック

PackRawは、ユーザーの操作に対して明確な視覚的フィードバックを提供します。

#### ボタンの状態

- **有効なボタン**: 通常の色で表示
- **無効なボタン**: グレーアウト表示
- **ホバー時**: 色が濃くなる、拡大効果
- **クリック時**: ローディングスピナー表示

#### アニメーション効果

- **休憩予約アイコン**: パルスアニメーション（透明度の変化）
- **ローディング**: 回転スピナー
- **モーダル**: フェードイン/アウト

---

## 設定項目

画面右上の ⚙️ アイコンから設定画面を開けます。

### 自動出勤・退勤機能（v2.2新機能）

アプリ起動時とPCシャットダウン時に自動で打刻を行う機能です。

#### 設定方法

1. **設定画面を開く**
   - 画面右上の ⚙️ アイコンをクリック

2. **自動出勤を有効化**
   - 「アプリ起動時に自動出勤」のトグルスイッチをONにする

3. **自動退勤を有効化**
   - 「PCシャットダウン時に自動退勤」のトグルスイッチをONにする

#### 動作内容

- **アプリ起動時の自動出勤**（v2.3で最適化）
  - 打刻記録がない場合（初回起動時）のみ自動的に出勤打刻を実行
  - 前回退勤している場合は自動出勤されません（手動出勤を促す）

- **PCシャットダウン時の自動退勤**
  - PCのシャットダウンイベントを検知
  - 退勤していない場合に自動的に退勤打刻を実行
  - シャットダウンを一時停止し、打刻完了後に許可

**⚠️ 注意**:
- 自動出勤は初回起動時のみ動作します（v2.3改善）
- 既に退勤している場合は翌日まで自動出勤されません
- 自動退勤は勤務中の場合のみ動作します

### 休憩打刻予約機能（v2.2新機能）

指定した時刻に自動的に休憩打刻を行う機能です。

#### 設定方法

1. **設定画面を開く**
   - 画面右上の ⚙️ アイコンをクリック

2. **自動休憩打刻を有効化**
   - 「自動休憩打刻を有効にする」のトグルスイッチをONにする

3. **休憩時間を設定**
   - 休憩開始予約時間（デフォルト: 12:00）
   - 休憩終了予約時間（デフォルト: 13:00）
   - ランダム誤差（デフォルト: ±5分）

#### 動作内容

- **指定時刻に自動打刻**
  - 設定した時刻になると自動的に休憩開始/終了を打刻
  - 1分ごとに時刻を監視

- **ランダム誤差機能**
  - 設定した誤差範囲内でランダムに打刻時刻をずらします
  - 例: 12:00、誤差±5分 → 11:55〜12:05の間にランダムに打刻
  - 毎日異なるタイミングで自動打刻されます

- **予約状態の表示**（v2.3改善）
  - 今日の日付の場合のみ表示
  - 休憩履歴セクションの「+」ボタンの左に時計アイコン（🕐）が表示されます
  - マウスホバーで予約時刻が表示されます
    - 例: 「次の予約: 12:05 休憩開始」

**⚠️ 注意**:
- 無効化すると時刻設定フィールドはグレーアウトされます
- 過去日・未来日選択時は予約アイコンは表示されません（今日のみ）
- 日付が変わると自動的にスケジュールが再生成されます

### PowerMonitor（システムイベント監視）

PCのシステムイベント（画面ロック、スリープ）を検知し、自動休憩や自動退勤を行う機能です。

#### 設定方法

1. **設定画面を開く**
   - 画面右上の ⚙️ アイコンをクリック

2. **PowerMonitorを有効化**
   - 「PCイベント監視」のトグルスイッチをONにする

3. **指定時刻以降の自動退勤を設定（オプション）**
   - 「指定時刻以降のスリープ時に自動退勤」をONにする
   - 退勤時刻を設定（例: 18:00）
   - この時刻以降にPCをスリープ・画面ロックすると自動的に退勤打刻されます

4. **動作確認**
   - 有効化すると、休憩履歴セクションに稲妻アイコン（⚡）が表示されます
   - 以下のイベントが検知されます:
     - 画面ロック
     - 画面アンロック
     - スリープ
     - スリープ解除

#### 動作内容

- **指定時刻前のイベント検知時**
  - 画面ロック/スリープ時: 自動的に休憩開始打刻
  - 画面アンロック/スリープ解除時: 自動的に休憩終了打刻
  - 画面をリフレッシュ（ボタン状態と打刻履歴を更新）

- **指定時刻以降のイベント検知時**
  - 画面ロック/スリープ時: 自動的に退勤打刻
    - 休憩中の場合は、自動的に休憩終了してから退勤
    - 既に退勤している場合は何もしません
  - 自動休憩機能は実行されません（自動退勤が優先）

**動作例**:
- 設定: 18:00以降に自動退勤
- 17:50にPCをロック → 休憩開始打刻
- 18:10にPCをロック → 退勤打刻（休憩中なら先に休憩終了）

#### 視覚的フィードバック（v2.3新機能）

- **稲妻アイコン（⚡）**: PowerMonitor有効時に休憩履歴セクションに表示
  - システムイベント監視中であることを示します
  - 青色で表示されます

#### 効果

- PCをロックした際に、自動的に最新の打刻状態を反映
- スリープから復帰した際に、画面を最新の状態に更新
- 退勤時刻以降は自動的に退勤処理を実行
- 退勤忘れを防止

**⚠️ 注意**:
- 指定時刻以降の自動退勤は、画面ロック/スリープ時のみ動作します
- 土日の自動退勤は設定により無効化できます
- 休憩中に自動退勤が発生した場合、自動的に休憩終了してから退勤します

### ウィンドウ設定

#### 常に最前面表示

- デフォルトで有効になっています
- 他のウィンドウの前面に常に表示されます
- 作業中でも打刻しやすくなります

#### ウィンドウサイズ

- デフォルト: 500 x 500 ピクセル
- リサイズ可能です
- 設定は自動的に保存されます

### システムトレイ（macOS）

- ウィンドウを閉じるとシステムトレイに格納されます
- トレイアイコンをクリックすると、ウィンドウが再表示されます
- トレイアイコンを右クリックすると、メニューが表示されます:
  - **ウィンドウを表示**: アプリを前面に表示
  - **アプリを終了**: アプリを完全に終了

---

## 自動更新について

PackRawは自動的に新しいバージョンをチェックし、更新を通知します。

### 更新の流れ

1. **更新の通知**
   - アプリ起動後、バックグラウンドで自動的に更新をチェックします
   - 新しいバージョンが利用可能になると、通知ダイアログが表示されます
   - 「ダウンロード」ボタンをクリックして更新をダウンロードできます

2. **更新のダウンロード**
   - ダウンロード中もアプリは通常通り使用できます
   - ダウンロード進捗は通知で確認できます

3. **更新のインストール**
   - ダウンロードが完了すると、インストール準備完了の通知が表示されます
   - 「今すぐ再起動」または「次回起動時」を選択できます
   - 「今すぐ再起動」を選択すると、アプリが自動的に再起動して更新が適用されます
   - 「次回起動時」を選択すると、次回アプリを終了した際に自動的にインストールされます

4. **設定の保持**
   - 更新時、すべての設定（認証情報、ウィンドウサイズ等）は自動的に保持されます
   - 再認証は不要です

### 更新チェックのタイミング

- アプリ起動後30秒後に初回チェック
- その後6時間ごとに定期チェック

### 手動で更新を確認

自動更新を待たずに、手動で更新を確認することもできます（将来実装予定）。

---

## アンインストール方法

### Windows

1. **アンインストール手順**
   - Windowsの「設定」→「アプリ」→「インストールされているアプリ」
   - 「PackRaw」を検索
   - [アンインストール] をクリック

2. **設定ファイルについて**
   - アンインストール後も設定ファイルは保持されます
   - これにより、再インストール時に認証情報が復元されます（refreshTokenの有効期限内）
   - 設定ファイルの場所: `C:\Users\{ユーザー名}\AppData\Roaming\PackRaw\freee-app-config.json`

### macOS

1. **アンインストール手順**
   - Applicationsフォルダから「PackRaw」を削除
   - ゴミ箱を空にする

2. **設定ファイルについて**
   - アンインストール後も設定ファイルは保持されます
   - これにより、再インストール時に認証情報が復元されます（refreshTokenの有効期限内）
   - 設定ファイルの場所: `~/Library/Application Support/PackRaw/freee-app-config.json`

### 完全アンインストール（すべての設定を削除）

設定ファイルも含めて完全に削除したい場合:

**Windows**:
1. 通常のアンインストールを実行
2. エクスプローラーのアドレスバーに `%APPDATA%` を入力してEnter
3. `PackRaw` フォルダを削除

**macOS**:
1. Applicationsフォルダから「PackRaw」を削除
2. Finderで「移動」→「フォルダへ移動」→ `~/Library/Application Support` を入力
3. `PackRaw` フォルダを削除

これにより、保存された認証情報と設定がすべて削除されます。

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. 「API service not initialized」エラー

**原因**: 設定ファイルが正しく配置されていない

**解決方法**:
1. 設定ファイルの配置場所を確認
   - **macOS**: `~/Library/Application Support/PackRaw/freee-app-config.json`
   - **Windows**: `%APPDATA%\PackRaw\freee-app-config.json`
2. config.precena.json を正しい場所にコピー
3. アプリを再起動

#### 2. 「リフレッシュトークンの有効期限が切れています」エラー

**原因**: 90日以上経過してリフレッシュトークンが失効

**解決方法**:
1. アプリのメイン画面で「freeeにログイン」ボタンをクリック
2. freee認証画面で再度許可
3. 自動的に新しいトークンが発行されます

#### 3. 打刻が失敗する

**原因**: freee側の設定や、APIの接続に問題がある

**解決方法**:
1. インターネット接続を確認
2. freee Web画面で勤怠設定を確認
3. 事業所ID（companyId）が正しいか確認
4. それでも解決しない場合は、再認証を試す

#### 4. 勤務時間が表示されない（00:00のまま）

**原因**: 打刻直後でwork_records APIにデータが反映されていない

**解決方法**:
- 通常は数秒〜数分で自動的に表示されます
- 画面を更新（日付を前後に動かして戻す）すると最新データが取得されます
- それでも表示されない場合は、アプリを再起動

#### 5. 時刻がずれて表示される

**原因**: PCのタイムゾーン設定が日本時間（JST）になっていない

**解決方法**:
1. PCのタイムゾーン設定を確認
2. 日本時間（UTC+9）に設定
3. アプリを再起動

#### 6. 退勤打刻がない場合に編集できない

**原因**: freee APIの仕様上の制限

**解決方法**:
1. まず退勤打刻を行う
2. 退勤打刻後に出勤時刻や休憩時間を編集可能になります
3. 編集ボタンがグレーアウトしている場合は、マウスオーバーで理由が表示されます

#### 7. Port 3000 is already in use エラー（開発者向け）

**原因**: 開発サーバーがすでに起動している

**解決方法**:
```bash
# ポート3000を使用しているプロセスを停止
lsof -ti:3000 | xargs kill -9

# または、すべての関連プロセスを停止
pkill -9 -f "electron|vite|concurrently"
```

### サポート

問題が解決しない場合は、以下までご連絡ください：

- **Slack**: [#times_kobaken](https://precena.slack.com/archives/CF7PFK3SN)
- **問題報告**: [GitHubのIssue](https://github.com/your-org/freee-webview-app/issues)（開発者向け）

---

## セキュリティとプライバシー

### データの保存場所

- **認証トークン**: ローカルディスク上に暗号化して保存
- **設定情報**: electron-storeにより安全に管理

### セキュリティ機能

- ✅ OAuth2.0による安全な認証
- ✅ アクセストークンは6時間で自動更新
- ✅ リフレッシュトークンは90日間有効
- ✅ 認証情報はローカルに暗号化して保存
- ✅ freee APIとの通信は全てHTTPS

### プライバシー

- インターネット接続はfreee APIとの通信のみ
- 勤怠データは全てfreee上に保存され、アプリには一時的にキャッシュされるのみ
- 第三者にデータが送信されることはありません

---

## バージョン情報

- **現在のバージョン**: v2.4
- **対応freee人事労務API**: v1
- **Electron**: 37.2.0
- **React**: 19.1.0

### リリースノート

#### v2.4 (2025-10-22) - カレンダーUI機能

**新機能**:
- カレンダーモーダル実装
  - 月間カレンダービュー（月曜始まり、7x6グリッド）
  - 前月・次月への移動、今日に戻るボタン
  - 日付クリックでカレンダー表示
- 勤怠記録がある日付に緑のドット表示
- モダンなUIデザイン（白背景、丸角、シャドウ）

**UI改善**:
- ヘッダーレイアウト改善
  - 日付と勤務時間を中央揃え
  - 時刻を36pxに拡大表示
  - 「勤務時間」ラベルと時刻を横並び
- PowerMonitor表示
  - システムイベント監視中を稲妻アイコンで表示
  - 休憩履歴セクションに配置

#### v2.3 (2025-10-22) - UI/UX改善

**UI統一化**:
- 出勤ボタン: 人アイコン + 「出勤」テキスト（履歴表示と統一）
- 退勤ボタン: ドアアイコン + 「退勤」テキスト（履歴表示と統一）
- 休憩予約表示: シンプルな時計アイコン（休憩履歴の+ボタンの左）
  - マウスホバーでツールチップ表示
  - 過去日選択時は非表示
  - アンバー色のパルスアニメーション

**最適化**:
- 自動出勤条件の最適化
  - 初回起動時（lastType === null）のみ自動出勤
  - 前回退勤している場合は手動出勤を促す
- シャットダウン時の処理フローを改善（finally で app.quit() 保証）

#### v2.2 (2025-10-20) - 自動機能実装

**新機能**:
- 休憩打刻予約機能（自動休憩打刻・ランダム誤差）
- 自動出勤・退勤機能（アプリ起動時・PCシャットダウン時）

**最適化**:
- API呼び出し40%削減でレスポンス速度改善
- UI改善: 次回予約バナー、設定フィールドの無効化

### 最新バージョンの確認

最新版は[ダウンロードページ](https://drive.google.com/drive/folders/1iSum8GMah5t5AZS-wMM0aTwhjhRrjDc2)で確認できます。

---

## ライセンス

ISC License

---

**©️ 2025 PackRaw - freee勤怠打刻デスクトップアプリケーション**
